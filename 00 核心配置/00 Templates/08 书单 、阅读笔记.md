<%*
// 通用知识笔记模板 - 简化实用版

const now = moment();

// 基础信息输入
const title = await tp.system.prompt("笔记标题", "如何高效学习");
const sourceType = await tp.system.suggester(["文章", "书籍", "视频", "课程", "其他"], ["文章", "书籍", "视频", "课程", "其他"]);
const author = await tp.system.prompt("作者/来源", "");
const tagsInput = await tp.system.prompt("标签（用逗号分隔）", "学习, 效率, 方法");

// 处理标签
const tags = tagsInput.split(",").map(tag => tag.trim()).filter(tag => tag);

// 生成文件名
const cleanTitle = title.replace(/[《》【】]/g, "").substring(0, 20);
const fileName = `${sourceType}-${cleanTitle}-${now.format("YYYY-MM-DD")}.md`;

// 文件路径设置
const baseFolder = "02 知识体系";
const typeFolder = `${baseFolder}/${sourceType}`;

// 创建必要文件夹
try {
  if (!app.vault.getAbstractFileByPath(baseFolder)) {
    await app.vault.createFolder(baseFolder);
  }
  if (!app.vault.getAbstractFileByPath(typeFolder)) {
    await app.vault.createFolder(typeFolder);
  }
} catch (error) {
  new Notice(`创建文件夹失败: ${error.message}`, 3000);
  return;
}

const fullPath = `${typeFolder}/${fileName}`;

// 检查文件是否存在
if (app.vault.getAbstractFileByPath(fullPath)) {
  new Notice("⚠️ 笔记已存在！", 3000);
  return;
}

// 构建内容
const content = `---
title: ${title}
source_type: ${sourceType}
author: ${author || "未知"}
date: ${now.format("YYYY-MM-DD")}
tags: [${tags.join(", ")}]
status: 待处理/学习中/已完成
---

# ${title}

## 📌 基本信息
- **类型**：${sourceType}
- **来源**：${author || "未知"}
- **记录日期**：${now.format("YYYY-MM-DD")}
- **关联标签**：${tags.map(tag => `#${tag}`).join(" ")}

## 🎯 核心价值
- 这篇文章/书籍最重要的观点是什么？
- 对我的主要价值在哪里？

## 📝 关键内容
### 1. 核心观点
- 
- 

### 2. 重要概念
- **概念1**：解释
- **概念2**：解释

### 3. 实践方法
- 步骤1：
- 步骤2：

## 💡 个人启发
### 认知升级
- 新的认识：
- 改变的观念：

### 行动启示
- 可以立即做的事情：
- 需要长期坚持的：

## 🔗 知识关联
- 与哪些已有知识相关？
- 可以应用在哪些场景？

## 📋 行动计划
- [ ] 短期行动（本周）
- [ ] 中期行动（本月）
- [ ] 长期行动（今年）

## 📎 参考资料
- 原文链接：
- 相关资源：
- 延伸阅读：

---

## ✍️ 记录日志
| 日期 | 进度 | 收获 |
|------|------|------|
| ${now.format("MM-DD")} | 开始记录 | |
| | | |
`;

// 创建文件
try {
  await app.vault.create(fullPath, content);
  new Notice(`✅ "${title}" 笔记已创建`, 2000);
  
  const newFile = app.vault.getAbstractFileByPath(fullPath);
  if (newFile) {
    await app.workspace.getLeaf().openFile(newFile);
  }
} catch (error) {
  new Notice(`创建失败: ${error.message}`, 4000);
}
%>