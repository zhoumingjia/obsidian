<%*
// ===================== 核心配置区（可自定义） =====================
const config = {
  // 基础路径配置（适配你之前的目录体系）
  rootFolder: "01 日常笔记",    // 根目录（对应你原01每日笔记）
  dailyFolderCN: "日记",        // 日记子文件夹名
  // Obsidian学习资料路径（固定关联你之前的知识体系目录）
  obsidianLearnPath: "02 知识体系/00 技术领域/",
  // 日期配置（用tp.date替代moment，避免报错）
  date: tp.date.now("YYYY-MM-DD"),
  dateCN: tp.date.now("YYYY-MM-DD") + " " + ["日","一","二","三","四","五","六"][new Date().getDay()], // 中文星期
  timeStr: tp.date.now("YYYYMMDD"),
  fullTime: tp.date.now("YYYY-MM-DD HH:mm:ss"),
  // 交互式提问（可选，增强模板实用性）
  mood: await tp.system.prompt("今日心情（可选）", "🌟 平静"),
  focus: await tp.system.prompt("今日核心关键词（可选）", ""),
  relateFiled: await tp.system.prompt ("关联的目录",""),
  author: tp.frontmatter?.author || tp.config?.user_name || "自己",
  // 文件名规则
  fileName: `${tp.date.now("YYYY-MM-DD")}.md`
};

// ===================== 自动创建分层文件夹 =====================
const createFolder = async (path) => {
  if (!app.vault.getAbstractFileByPath(path)) {
    await app.vault.createFolder(path);
    console.log(`✅ 创建文件夹：${path}`);
  }
};
// 按 根目录/年/月/日记 分层创建
await createFolder(config.rootFolder);
await createFolder(`${config.rootFolder}/${tp.date.now("YYYY")}`);
await createFolder(`${config.rootFolder}/${tp.date.now("YYYY")}/${tp.date.now("MM")}`);
await createFolder(`${config.rootFolder}/${tp.date.now("YYYY")}/${tp.date.now("MM")}/${config.dailyFolderCN}`);

// ===================== 防重复创建文件 =====================
const fullPath = `${config.rootFolder}/${tp.date.now("YYYY")}/${tp.date.now("MM")}/${config.dailyFolderCN}/${config.fileName}`;
if (app.vault.getAbstractFileByPath(fullPath)) {
  new Notice(`⚠️ 今日日记${config.dateCN}已存在！`, 3000);
  return;
}

// ===================== 日记内容模板（核心） =====================
const content = `---
title: 日记 ${config.dateCN}
date: ${config.fullTime}
author: ${config.author}
mood: ${config.mood}
focus: ${config.focus || "无"}
tags: [日记, 日常, Obsidian学习, ${tp.date.now("YYYY")}] # 保留Obsidian学习标签
---

# 📝 日记 | ${config.dateCN}

## 一、今日概览
- 心情状态：${config.mood}
- 核心关键词：${config.focus || "无"}
- 天气/环境： 

## 二、今日完成
- 

## 三、今日学习（Obsidian） # 保留你要的Obsidian学习板块
- 学习内容：
	- 
- 核心笔记：[[${config.obsidianLearnPath}${config.relateFiled}/00 基础操作.md]] 
- 问题记录：
- 解决方法：

## 四、待办事项
- 

## 五、今日感想
- ✨ 开心的事：
- 📌 遗憾的事：
- 💡 收获与思考：

## 六、明日计划
- （Obsidian学习）：
- 其他计划：

## 七、随手记
- 灵感/想法：
- 待整理资料：
- 其他：
`;

// ===================== 生成文件并打开 =====================
await app.vault.create(fullPath, content);
const newFile = app.vault.getAbstractFileByPath(fullPath);
if (newFile) await app.workspace.getLeaf().openFile(newFile);
new Notice(`✅ 日记${config.dateCN}已生成！路径：${fullPath}`, 3000);
%>