<%*
// 核心配置（自动计算汇报周期，无需手动输入）
const config = {
  folder: "工作/工作汇报", // 自动创建「工作汇报」文件夹
  // 🌟 核心修改：自动计算本周一至周日的周期，或单日期+星期（可按需切换）
  cycle: await autoGenerateCycle(), // 调用自动生成周期的函数
  author: tp.frontmatter?.author || "（填写姓名）",
  date: tp.date.now("YYYY-MM-DD"),
  timeStr: tp.date.now("YYYYMMDDHHmmss"), // 用于文件名防重复
  module: "双录系统/音视频集群" // 固定模块，贴合你的业务场景
};

// 🔧 自动生成汇报周期的核心函数（可自定义规则）
async function autoGenerateCycle() {
  // 规则1：生成「当前日期 + 星期几」（如：2026-01-16 周一）【默认】
  const today = new Date();
  const weekDays = ["周日", "周一", "周二", "周三", "周四", "周五", "周六"];
  const dayOfWeek = weekDays[today.getDay()]; // 获取今天是周几
  const dateStr = tp.date.now("YYYY-MM-DD"); // 今天的日期
  const defaultCycle = `${dateStr} ${dayOfWeek}`;

  // 保留手动修改的灵活性：弹出输入框，默认填充自动计算的周期
  return await tp.system.prompt("汇报周期（可修改）", defaultCycle);
}

// 1. 自动创建「工作汇报」文件夹（不存在则创建）
const folder = app.vault.getAbstractFileByPath(config.folder);
if (!folder) await app.vault.createFolder(config.folder);

// 2. 定义规范的文件名（避免重复）
const fileName = `工作周报-${config.cycle.replace(/\s+/g, "-")}-${config.timeStr}.md`;

// 3. 构造周报内容（所有变量通过JS插值解析）
const content = `---
title: 工作周报-${config.cycle}
汇报人: ${config.author}
汇报日期: ${config.date}
模块: ${config.module}
---
# 工作周报（${config.cycle}）
## 一、本周完成
1. ${config.module}：（如：接口文档编写、音视频集群调优）
2. 问题处理：（如：线上BUG修复、性能瓶颈排查）
3. 协作事项：

## 二、进度风险
- 未完成项：
- 阻碍原因：
- 解决方案：

## 三、下周计划
1. 优先级1：（核心任务）
2. 优先级2：（常规任务）
3. 学习计划：
`;

// 4. 生成文件到指定文件夹
const fullPath = `${config.folder}/${fileName}`;
await app.vault.create(fullPath, content);

// 5. 自动打开文件+简洁提示
const newFile = app.vault.getAbstractFileByPath(fullPath);
if (newFile) await app.workspace.getLeaf().openFile(newFile);
new Notice(`✅ 工作周报已生成：${config.cycle}`, 2000);
%>